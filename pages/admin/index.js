import { useEffect, useState } from "react";
import { useDispatch, useSelector } from "react-redux";
import Head from "next/head";

// admin components
import SuperAdmin from "./../../app/components/admin-components/SuperAdmin";
import NotSuperAdmin from "./../../app/components/admin-components/NotSuperAdmin";
import { getAllUsers, updateAllPage } from "../../store/reducer/loginReducer";
import Axios from "axios";
export default function Index() {
  const { isAdmin, users } = useSelector((state) => state.login);
  const dispatch = useDispatch();
  useEffect(() => {
    dispatch(updateAllPage());
  }, []);

  return (
    <div>
      <Head>
        <title>Handmade.Travel || Admin Page</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
          href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap"
          rel="stylesheet"
        />
      </Head>
      <SwitchPage isAdmin={isAdmin} users={users} />
    </div>
  );
}

const SwitchPage = ({ isAdmin, users }) => {
  const [user, setUser] = useState({});

  useEffect(async () => {
    try {
      const res = await Axios.get("http://localhost:5000/api/user/me", {
        headers: {
          Authorization: JSON.parse(localStorage.getItem("my-token")) || "no",
        },
      });
      const data = await res.data;
      console.log("user", data);
      setUser(data);
    } catch (error) {}
  }, [isAdmin]);
  if (isAdmin) {
    if (user.role === "admin") {
      return (
        <section>
          <Head>
            <title>Hello basic {user.username}</title>
          </Head>
          <SuperAdmin />
        </section>
      );
    } else {
      <section>
        <Head>
          <title>Hello {user.username}</title>
        </Head>
        <NotSuperAdmin admin={user} />
      </section>;
    }
  }

  return (
    <section>
      <Head>
        <title>Loading...</title>
      </Head>
      <h3 className="text-center">404 not found</h3>
    </section>
  );
};
